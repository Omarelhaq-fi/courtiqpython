<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - CourtIQ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #111827; color: #F3F4F6; }
        .sidebar { background-color: #1F2937; }
        .nav-link { color: #9CA3AF; transition: all 0.2s ease-in-out; }
        .nav-link:hover, .nav-link.active { background-color: #374151; color: #F97316; }
        .content-card { background-color: #1f2937; border: 1px solid #374151; }
        .player-summary-card { background: linear-gradient(to right, #374151, #1f2937); border-left: 4px solid #F97316; }
        .multi-select { height: 150px; }
    </style>
</head>
<body class="flex h-screen">

    <!-- Sidebar -->
    <aside class="w-64 sidebar flex-shrink-0">
        <div class="flex items-center justify-center h-20 border-b border-gray-700">
            <h1 class="text-3xl font-bold text-white">Court<span class="text-orange-500">IQ</span></h1>
        </div>
        <nav class="mt-6">
            <a href="#" class="nav-link active flex items-center py-3 px-6" onclick="showTab('dashboard')"><i class="fas fa-tachometer-alt mr-3"></i> Dashboard</a>
            <a href="#" class="nav-link flex items-center py-3 px-6" onclick="showTab('scouting')"><i class="fas fa-clipboard-list mr-3"></i> Scouting Panel</a>
            <a href="#" class="nav-link flex items-center py-3 px-6" onclick="showTab('coach_board')"><i class="fas fa-chalkboard-teacher mr-3"></i> Coach Board</a>
            <a href="#" class="nav-link flex items-center py-3 px-6" onclick="showTab('reports')"><i class="fas fa-chart-bar mr-3"></i> Reports</a>
            {% if role == 'admin' %}<a href="#" class="nav-link flex items-center py-3 px-6" onclick="showTab('admin')"><i class="fas fa-users-cog mr-3"></i> Admin Panel</a>{% endif %}
        </nav>
        <div class="absolute bottom-0 w-64 p-6 border-t border-gray-700">
             <div class="text-gray-400 text-sm">Logged in as:</div>
             <div class="font-bold text-white">{{ username }}</div>
             <a href="{{ url_for('logout') }}" class="block w-full text-center mt-4 bg-orange-600 hover:bg-orange-700 text-white font-bold py-2 px-4 rounded">Logout</a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 p-8 overflow-y-auto">
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content">
            <h2 class="text-3xl font-bold mb-6">Player Career Stats</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {% for player in players %}
                <div class="content-card rounded-lg p-5 player-summary-card">
                    <h3 class="font-bold text-xl text-white">{{ player.name }}</h3>
                    <p class="text-orange-400">{{ player.team_name or 'No Team' }}</p>
                    <div class="mt-4 grid grid-cols-3 gap-4 text-center">
                        <div><p class="text-2xl font-bold">{{ "%.1f"|format(player.ppg) }}</p><p class="text-xs text-gray-400">PPG</p></div>
                        <div><p class="text-2xl font-bold">{{ "%.1f"|format(player.rpg) }}</p><p class="text-xs text-gray-400">RPG</p></div>
                        <div><p class="text-2xl font-bold">{{ "%.1f"|format(player.apg) }}</p><p class="text-xs text-gray-400">APG</p></div>
                    </div>
                </div>
                {% else %}
                    <p class="text-gray-400">No players found. Add teams and players from the Admin Panel.</p>
                {% endfor %}
            </div>
        </div>

        <!-- Scouting Panel Tab -->
        <div id="scouting" class="tab-content hidden h-full">
             <h2 class="text-3xl font-bold mb-6">Scouting Panel</h2>
             <div class="content-card rounded-lg h-[calc(100%-5rem)]">
                <iframe src="{{ url_for('scouting_panel') }}" class="w-full h-full border-0 rounded-lg"></iframe>
             </div>
        </div>
        
        <!-- Coach Board Tab -->
        <div id="coach_board" class="tab-content hidden h-full">
             <h2 class="text-3xl font-bold mb-6">Coach Board</h2>
             <div class="content-card rounded-lg h-[calc(100%-5rem)]">
                <iframe src="{{ url_for('coach_board') }}" class="w-full h-full border-0 rounded-lg"></iframe>
             </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content hidden">
            <h2 class="text-3xl font-bold mb-6">Reports History</h2>
            <div class="content-card rounded-lg p-5">
                <ul class="space-y-3">
                    {% for report in reports %}
                    <li>
                        <a href="{{ url_for('view_report', report_id=report.id) }}" class="text-orange-500 hover:underline text-lg">
                            Report for {{ report.team_name }} - {{ report.created_at.strftime('%Y-%m-%d %H:%M') }}
                        </a>
                    </li>
                    {% else %}
                    <p class="text-gray-400">No reports have been generated yet.</p>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <!-- Admin Panel Tab -->
        {% if role == 'admin' %}
        <div id="admin" class="tab-content hidden">
            <h2 class="text-3xl font-bold mb-6">Admin Panel</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="space-y-8">
                    <div class="content-card rounded-lg p-6"><h3 class="text-xl font-bold mb-4">Add New Team</h3><form action="{{ url_for('add_team') }}" method="POST" class="space-y-4"><input type="text" name="team_name" required class="w-full bg-gray-700 border border-gray-600 rounded-md p-2" placeholder="Team Name"><button type="submit" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-2 px-4 rounded">Add Team</button></form></div>
                    <div class="content-card rounded-lg p-6"><h3 class="text-xl font-bold mb-4">Add New Player</h3><form action="{{ url_for('add_player') }}" method="POST" class="space-y-4"><select name="team_id" required class="w-full bg-gray-700 border border-gray-600 rounded-md p-2"><option value="">Select Team...</option>{% for team in teams %}<option value="{{ team.id }}">{{ team.name }}</option>{% endfor %}</select><input type="text" name="player_name" required class="w-full bg-gray-700 border border-gray-600 rounded-md p-2" placeholder="Player Name"><input type="text" name="player_number" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2" placeholder="Player Number"><input type="text" name="position" class="w-full bg-gray-700 border border-gray-600 rounded-md p-2" placeholder="Position"><button type="submit" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-2 px-4 rounded">Add Player</button></form></div>
                    <div class="content-card rounded-lg p-6"><h3 class="text-xl font-bold mb-4">Add New Coach</h3><form action="{{ url_for('add_coach') }}" method="POST" class="space-y-4"><input type="text" name="coach_username" required class="w-full bg-gray-700 border border-gray-600 rounded-md p-2" placeholder="Coach Username"><input type="password" name="coach_password" required class="w-full bg-gray-700 border border-gray-600 rounded-md p-2" placeholder="Coach Password"><button type="submit" class="w-full bg-orange-600 hover:bg-orange-700 text-white font-bold py-2 px-4 rounded">Add Coach</button></form></div>
                </div>
                <div class="content-card rounded-lg p-6"><h3 class="text-xl font-bold mb-4">Assign Resources to Coach</h3><form action="{{ url_for('assign_resources') }}" method="POST" class="space-y-4"><div><label class="block text-sm font-medium text-gray-300">Select Coach</label><select name="coach_id" required class="w-full bg-gray-700 border border-gray-600 rounded-md p-2"><option value="">Select Coach...</option>{% for coach in coaches %}<option value="{{ coach.id }}">{{ coach.username }}</option>{% endfor %}</select></div><div><label class="block text-sm font-medium text-gray-300">Assign Teams (Multiple)</label><select name="assigned_teams" multiple class="multi-select w-full bg-gray-700 border border-gray-600 rounded-md p-2">{% for team in teams %}<option value="{{ team.id }}">{{ team.name }}</option>{% endfor %}</select></div><div><label class="block text-sm font-medium text-gray-300">Assign Individual Players (Multiple)</label><select name="assigned_players" multiple class="multi-select w-full bg-gray-700 border border-gray-600 rounded-md p-2">{% for player in players %}<option value="{{ player.id }}">{{ player.name }} ({{player.team_name}})</option>{% endfor %}</select></div><button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Save Assignments</button></form></div>
            </div>
        </div>
        {% endif %}
    </main>

    <script>
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.add('hidden'));
            document.getElementById(tabName).classList.remove('hidden');
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('onclick').includes(`'${tabName}'`)) {
                    link.classList.add('active');
                }
            });
        }
    </script>
</body>
</html>
